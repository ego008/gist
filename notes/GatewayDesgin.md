## 分布式服务器框架中的网关设计

### 服务节点化

每个服务为一个节点，节点可以数字化，比如邮件服务号是5，开启的第一个邮件服务实例的节点号可以是0501，第二个实例是0502
所有节点启动的时候首先从etcd里获取自己的配置环境信息

### 静态化

gateway本身也是一个服务节点，但是作为分布式系统中的一个静态部分(static part)

所有节点开启后与gateway相连，服务A要与服务B通信时，A的消息先流向gateway，再由gateway流向B

gateway内部做消息路由

* 支持路由给指定节点号的服务
* 支持每次路由给任意的同类型服务
* 支持第一次路由给任意同类型服务，但后续消息都是与这个服务交互

### 负载均衡

* 支持多个gateway的集群式部署，内部通过一些一致性协议同步路由表


### 消息驻留

如果A发送消息给B，但此时B没有在线，则消息应该在内存中驻留一段时间
由此提供一个安全平滑的服务重启机制
